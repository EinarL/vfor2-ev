{% extends "base.html" %} {% block title %} Home Page {% endblock %}
{% block content %}
{% if your_listings %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <h1>Your Listings</h1>
{% else %}
    <h1>Listings</h1>
{% endif %}
<main >
    <section class="listings-container">
        {% for listing in listings %}
            <div class="listing-container">
                {% if your_listings %}
                    <button class="delete-listing-btn" onclick="deleteListing('{{ listing.id }}')">Close</button>
                {% endif %}
                <a href="{% url 'listing' id=listing.id %}" class="listing_link">
                    <div class="listing">
                        <div>
                            <h5 id="listing-title">{{listing.title}}</h4>
                            {% if listing.image_url %}
                                <img src="{{ listing.image_url }}" alt="">
                            {% endif %}
                            <p class="description">{{listing.text}}</p>
                        </div>
                        <p class="price" >{{listing.price}}kr.</p>
                    </div>
                </a>
            </div>
        {% endfor %}
    </section>
    <div class="paginator">
        <p>Page {{listings.number}} of {{listings.paginator.num_pages}}</p>
        <div class="page-links">
            {% if listings.has_previous %}
                <a href="?page={{ listings.previous_page_number }}">Previous Page</a>
            {% endif %}
            {% if listings.has_next %}
                <a href="?page={{ listings.next_page_number }}">Next Page</a>
            {% endif %}
        </div>
    </div>
</main>
{% if your_listings %}
<script>

function deleteListing(listingId){
    const confirmDelete = confirm("Are you sure you want to delete this listing?");
    if (!confirmDelete) return;

    // Make an AJAX request to delete the listing
    $.ajax({
        url: "/delete-listing/",
        type: "POST",
        data: { 
            listing_id: listingId,
            csrfmiddlewaretoken: "{{ csrf_token }}" 
        },
        success: function (response) {
            location.reload();
        },
        error: function (xhr, status, error) {
            console.error("Error:", error);
            alert("Internal server error: unable to delete the listing");
        }
    });
}

</script>
{% endif %}
{% endblock %}